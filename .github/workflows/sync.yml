# Synchronize this repository with its upstream source (Ultimaker/CuraEngine)

name: Synchronize
on:
  # Run on a schedule
  schedule:
    # Run every Saturday at 00:00 UTC
    - cron: '0 0 * * 6'

  # Run when manually triggered
  workflow_dispatch:

jobs:
  diff:
    name: Synchronize with upstream
    runs-on: ubuntu-latest
    steps:
      # Clone downstream (This repository)
      - name: Clone downstream
        uses: actions/checkout@v2

      # Add remote upstream
      - name: Add remote upstream
        run: git remote add upstream https://github.com/Ultimaker/CuraEngine.git

      # Merge upstream
      - name: Merge upstream
        run: git merge upstream/master

      # Delete workflows
      - name: Delete workflows
        run: |
          rm .github -r
          git add .github
          git commit -m "Deleted workflows"

       # Push changes to downstream
      - name: Push to downstream
        run: git push origin sync